---
solution: Journey Optimizer
product: journey optimizer
title: 将Journey Optimizer与外部系统集成
description: 了解将Journey Optimizer与外部系统集成时的最佳实践
role: User
level: Beginner
keywords: 外部， API，优化器，上限
exl-id: 27859689-dc61-4f7a-b942-431cdf244455
source-git-commit: 40afc1c0e0ae55dfbec45ff0b22170d6345a8e46
workflow-type: tm+mt
source-wordcount: '1201'
ht-degree: 2%

---

# 与外部系统集成 {#external-systems}

本页介绍Journey Optimizer在集成外部系统时提供的不同防护以及最佳实践：如何使用上限API优化对外部系统的保护，如何配置历程超时以及重试的工作方式。

借助 Journey Optimizer，您可以通过自定义数据源和自定义操作配置与外部系统的连接。例如，这允许您使用来自外部预订系统的数据扩充您的历程，或使用第三方系统(如Epsilon或Facebook)发送消息。

在集成外部系统时，您可能会遇到一些问题，系统可能运行缓慢、可能停止响应，或者可能无法处理较大的卷。 Journey Optimizer提供了多个护栏，以保护您的系统免遭过载。

所有外部系统在性能方面都各不相同。 您需要根据用例调整配置。

当Journey Optimizer执行对外部API的调用时，将按照以下方式执行技术防护：

1. 应用上限或限制规则：如果达到最大速率，则剩余的调用将被丢弃或排入队列。

2. 超时并重试：如果满足上限规则，Journey Optimizer会尝试执行调用，直到达到超时持续时间的结束。

## 限制API上限 {#capping}

### 关于上限和限制API

在配置数据源或操作时，您需要建立与系统的连接，以检索要在历程中使用的其他信息，或者发送消息或API调用。

历程API支持每秒最多5000个事件，但某些外部系统或API的吞吐量可能不相等。 为防止这些系统过载，您可以使用 **上限** 和 **限制** 用于限制每秒发送的事件数的API。

每次按历程执行API调用时，它都会通过API引擎。 如果达到API中设置的限制，则如果您使用上限API，则调用将被拒绝；或者，如果您使用限制API，则调用将排队长达6小时，并按收到它们的顺序尽快进行处理。

例如，假设您为外部系统定义了每秒100次调用的上限或限制规则。 在10个不同历程中，系统由自定义操作调用。 如果一个历程每秒收到200个调用，则它将使用100个可用插槽，并丢弃或排入剩余100个插槽的队列。 由于超出了最大速率，因此其他9个历程将没有任何插槽。 此粒度有助于保护外部系统免遭过载和崩溃。

>[!IMPORTANT]
>
>**上限规则** 在沙盒级别为特定端点（称为的URL）配置，但全局应用于该沙盒的所有历程。
>
>**限制规则** 仅在生产沙箱上配置，用于特定端点，但全局用于所有沙箱中的所有历程。 每个组织只能有一个限制配置。

有关如何使用API的更多信息，请参阅以下章节：

* [API上限](capping.md)
* [限制API](throttling.md)

有关API的详细描述，请参阅 [Adobe Journey Optimizer API文档](https://developer.adobe.com/journey-optimizer-apis/references/journeys/)

### 数据源和自定义操作容量 {#capacity}

对于 **外部数据源**，则每秒的最大调用数限制为15。 如果超出此限制，则会根据所使用的API，丢弃或排入任何其他调用。 通过联系Adobe以在中包含端点，可以增加专用外部数据源的此限制，但允许列表对于公共外部数据源，此选项不可用。 * [了解如何配置数据源](../datasource/about-data-sources.md).

>[!NOTE]
>
>如果数据源使用的自定义身份验证的端点与数据源使用的端点不同，则您需要联系Adobe以将该端点也包含在允许列表中。

对于 **自定义操作**，您需要评估外部API的容量。 例如，如果Journey Optimizer每秒发送1000个调用，而您的系统每秒只能支持100个调用，则您需要定义上限或流量配置，以便系统不会饱和。 [了解如何配置操作](../action/action.md)

## 超时和重试{#timeout}

如果满足上限或限制规则，则应用超时规则。

在每个历程中，您可以定义超时持续时间。 这允许您在调用外部系统时设置最大持续时间。 在历程的属性中配置超时持续时间。 请参见[此页面](../building-journeys/journey-gs.md#timeout_and_error)。

此超时对所有外部调用（自定义操作和自定义数据源中的外部API调用）都是全局的。 默认情况下，此值设置为30秒。

在定义的超时时间段内，Journey Optimizer会尝试调用外部系统。 首次调用后，最多可执行三次重试，直到达到超时持续时间的结束。 无法更改重试次数。

每次重试都使用一个插槽。 如果您的每秒100个调用的上限为，并且每个调用都需要两次重试，则速率会降至每秒30个调用(每个调用使用3个插槽：第一次调用和两次重试)。

超时持续时间值取决于用例。 如果要快速发送消息（例如当客户端进入商店时），则不希望设置长超时。 此外，超时时间越长，将越多的项目放入队列中。 这会对性能产生很大影响。 如果Journey Optimizer每秒执行1000次调用，则保留5或15秒的数据可能会很快压垮系统。

以超时5秒为例。

* 第一次调用持续时间不到5秒：调用成功，则不会执行重试。
* 第一次调用会持续5秒：调用已取消，且不会重试。 在报表中，此值会被计为超时错误。
* 第一次调用在2秒后失败（外部系统返回错误）：如果有上限插槽可用，则重试的时间还剩3秒。
   * 如果在5秒结束前三次重试中有一次成功，则会执行调用，并且没有错误。
   * 如果在重试期间达到超时时长的结束，则调用将被取消，并在报表中计为超时错误。

## 常见问题解答{#faq}

**如何配置上限或限制规则？ 是否有默认规则？**

默认情况下，没有上限或限制规则。 规则在沙盒级别使用上限或限制API为特定端点（称为的URL）定义。 请参阅[此小节](../configuration/external-systems.md#capping)。

**执行了多少次重试？ 我是否可以更改重试次数或定义两次重试之间的最短等待时间？**

对于给定的调用，在首次调用后最多可执行三次重试，直到达到超时持续时间的结束。 无法更改重试次数和每次重试间隔的时间。 请参阅[此小节](../configuration/external-systems.md#timeout)。

**在哪里可以配置超时？ 有最大值吗？**

在每个历程中，您可以定义超时持续时间。 在历程的属性中配置超时持续时间。 超时持续时间必须介于1秒到30秒之间。 请参阅 [此部分](../configuration/external-systems.md#timeout) 和 [本页](../building-journeys/journey-gs.md#timeout_and_error).