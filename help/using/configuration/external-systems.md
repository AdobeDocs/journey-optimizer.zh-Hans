---
solution: Journey Optimizer
product: journey optimizer
title: 將Journey Optimizer與外部系統整合
description: 瞭解將Journey Optimizer與外部系統整合的最佳實務
role: User
level: Beginner
keywords: 外部， API，最佳化程式，上限
exl-id: 27859689-dc61-4f7a-b942-431cdf244455
source-git-commit: 609fdb747b1b0f9e18a96f93a4e235d01da8ff72
workflow-type: tm+mt
source-wordcount: '1202'
ht-degree: 32%

---

# 与外部系统集成 {#external-systems}

本頁面說明整合外部系統時Journey Optimizer提供的各種護欄，以及最佳實務：如何使用上限API最佳化外部系統的保護、如何設定歷程逾時，以及重試如何運作。

借助 Journey Optimizer，您可以通过自定义数据源和自定义操作配置与外部系统的连接。舉例來說，這可讓您利用來自外部訂房系統的資料來豐富您的歷程，或是使用第三方系統(例如Epsilon或Facebook)傳送訊息。

整合外部系統時，您可能會遇到幾個問題：系統可能緩慢、停止回應，或可能無法處理大量磁碟區。 Journey Optimizer提供數個護欄，可防止系統超載。

所有外部系統的效能都不同。 您需要根據使用案例調整設定。

當Journey Optimizer執行對外部API的呼叫時，技術護欄會以下列方式執行：

1. 套用上限或節流規則：如果達到最大速率，剩餘的呼叫會捨棄或加入佇列。

2. 逾時並重試：如果已滿足上限或節流規則，Journey Optimizer會嘗試執行呼叫，直到逾時期間結束為止。

## 上限和節流API {#capping}

### 關於上限和節流API

在配置数据源或操作时，您需要建立与系统的连接，以检索要在历程中使用的其他信息，或者发送消息或 API 调用。

历程 API 支持每秒最多 5000 个事件，但某些外部系统或 API 的吞吐量可能不同。若要避免這些系統超載，您可以使用 **上限** 和 **節流** API可限制每秒傳送的事件數。

每次按历程执行 API 调用时，它都会通过 API 引擎。如果達到API中設定的限制，如果您使用上限API，呼叫會遭拒，或排入最多6小時的佇列，並在您使用節流API時，依照收到的順序儘快處理。

例如，假设您为外部系统定义了每秒 100 次调用的上限或限制规则。在 10 个不同历程中，系统由自定义操作调用。如果一个历程每秒收到 200 个调用，则将使用 100 个可用的位置，并丢弃剩余的 100 个调用或将它们排入队列。由于超出了最大使用率，因此其他 9 个历程将没有任何位置。此粒度有助于避免使外部系统出现过载和崩溃。

>[!IMPORTANT]
>
>**上限规则**&#x200B;在沙盒级别针对特定端点（调用的 URL）配置，但在全局范围内应用于该沙盒的所有历程。
>
>**限制规则**&#x200B;仅在生产沙盒上针对特定端点配置，但在全局范围内应用于所有沙盒中的所有历程。只能为每个组织使用一个限制配置。

如需如何使用API的詳細資訊，請參閱下列章節：

* [API 上限](capping.md)
* [API 限制](throttling.md)

API的詳細說明可在以下網址取得： [Adobe Journey Optimizer API檔案](https://developer.adobe.com/journey-optimizer-apis/references/journeys/)

### 数据源和自定义操作容量 {#capacity}

对于&#x200B;**外部数据源**，每秒的最大调用数限制为 15。如果超出此限制，则会根据所使用的 API，丢弃或排入任何其他调用。联系 Adobe 以将端点包含在允许列表中，这样可以增加专用外部数据源的此限制，但对于公共外部数据源不可以这样操作。* [了解如何配置数据源](../datasource/about-data-sources.md)。

>[!NOTE]
>
>如果数据源使用的自定义身份验证的端点与数据源使用的端点不同，您需要联系 Adobe 以将该端点也包含在允许列表中。

对于&#x200B;**自定义操作**，您需要评估外部 API 的容量。例如，如果 Journey Optimizer 每秒发送 1000 个调用，而您的系统每秒只能支持 100 个调用，则需要定义上限或限制配置，以便系统不会饱和。[了解如何配置操作](../action/action.md)

## 逾時和重試{#timeout}

如果符合上限或節流規則，則會套用逾時規則。

在每個歷程中，您可以定義逾時持續時間。 這可讓您設定呼叫外部系統時的最長持續時間。 逾時期間是在歷程的屬性中設定。 请参见[此页面](../building-journeys/journey-gs.md#timeout_and_error)。

此逾時對於所有外部呼叫（自訂動作和自訂資料來源中的外部API呼叫）都是全域逾時。 預設為30秒。

在定義的逾時期間，Journey Optimizer會嘗試呼叫外部系統。 在第一次呼叫後，最多可以執行三次重試，直到逾時期間結束為止。 無法變更重試次數。

每次重試使用一個槽。 如果您的上限為每秒100次呼叫，而您的每個呼叫需要重試兩次，則速率會降至每秒30次呼叫（每個呼叫使用3個槽：第一次呼叫和兩次重試）。

逾時期間值取決於使用案例。 如果您想要快速傳送訊息（例如，當使用者端進入商店時），則您不想設定長時間逾時。 此外，逾時時間越長，放入佇列中的專案就越多。 這可能會大幅影響效能。 如果Journey Optimizer每秒執行1000次呼叫，保留5或15秒的資料會迅速讓系統不知所措。

以逾時5秒為例。

* 第一個呼叫持續少於5秒：呼叫成功，不執行重試。
* 第一個呼叫會持續更長的5秒：呼叫已取消，而且不會重試。 在報表中計為逾時錯誤。
* 第一次呼叫會在2秒後失敗（外部系統傳回錯誤）：如果有上限插槽，重試還剩3秒。
   * 如果在5秒結束前三次重試其中一次成功，則會執行呼叫，而且沒有錯誤。
   * 如果在重試期間到達逾時持續時間的結尾，則會取消呼叫，並在報表中計為逾時錯誤。

## 常见问题解答{#faq}

**如何設定上限或節流規則？ 是否有預設規則？**

依預設，沒有上限或節流規則。 規則是使用上限或節流API，在特定端點（稱為的URL）的沙箱層級定義。 请参阅[此小节](../configuration/external-systems.md#capping)。

**執行多少次重試？ 我可以變更重試次數或定義兩次重試之間的最短等待時間嗎？**

對於指定的呼叫，在第一次呼叫之後最多可以執行三次重試，直到逾時期間結束為止。 無法變更重試次數和每次重試之間的時間。 请参阅[此小节](../configuration/external-systems.md#timeout)。

**我可以在哪裡設定逾時？ 是否有最大值？**

在每個歷程中，您可以定義逾時持續時間。 逾時期間是在歷程的屬性中設定。 逾時持續時間必須介於1秒到30秒之間。 請參閱 [本節](../configuration/external-systems.md#timeout) 和 [此頁面](../building-journeys/journey-gs.md#timeout_and_error).